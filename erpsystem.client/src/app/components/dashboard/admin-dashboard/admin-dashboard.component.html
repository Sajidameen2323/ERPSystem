<div class="min-h-screen bg-gray-50">
  <!-- Top Navigation -->
  <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <button
            type="button"
            class="md:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
            (click)="toggleSidebar()"
          >
            <lucide-icon [img]="isSidebarOpen ? xIcon : menuIcon" class="h-6 w-6"></lucide-icon>
          </button>
          
          <div class="flex-shrink-0 flex items-center ml-4 md:ml-0">
            <div class="h-8 w-8 bg-blue-600 rounded-lg flex items-center justify-center">
              <lucide-icon [img]="dashboardIcon" class="h-5 w-5 text-white"></lucide-icon>
            </div>
            <div class="ml-3">
              <h1 class="text-xl font-semibold text-gray-900">Admin Dashboard</h1>
            </div>
          </div>
        </div>
        
        <div class="flex items-center space-x-4">
          <!-- User Management Button -->
          <button
            type="button"
            class="p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md"
            (click)="navigateToUserManagement()"
            title="User Management"
          >
            <lucide-icon [img]="usersIcon" class="h-5 w-5"></lucide-icon>
          </button>
          
          <!-- Refresh Button -->
          <button
            type="button"
            class="p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md"
            (click)="refreshDashboard()"
            [disabled]="loading"
            title="Refresh Dashboard"
          >
            <lucide-icon [img]="refreshIcon" class="h-5 w-5" [class.animate-spin]="loading"></lucide-icon>
          </button>
          
          <!-- Config Toggle -->
          <button
            type="button"
            class="p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md"
            (click)="toggleConfigMode()"
            [class.bg-blue-100]="isConfigMode"
            [class.text-blue-600]="isConfigMode"
            title="Dashboard Settings"
          >
            <lucide-icon [img]="settingsIcon" class="h-5 w-5"></lucide-icon>
          </button>
          
          <!-- User Menu -->
          <div class="relative">
            <button
              type="button"
              class="flex items-center p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md"
              (click)="logout()"
            >
              <span class="text-sm text-gray-700 mr-2">Logout</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Mobile Sidebar Overlay -->
  <div 
    *ngIf="isSidebarOpen"
    class="fixed inset-0 bg-gray-600 bg-opacity-75 z-40 md:hidden"
    (click)="toggleSidebar()"
  ></div>

  <!-- Configuration Sidebar Overlay -->
  <div 
    *ngIf="isConfigMode"
    class="fixed inset-0 bg-gray-600 bg-opacity-75 z-40"
    (click)="closeConfigSidebar()"
  ></div>

  <!-- Configuration Sidebar -->
  <div 
    class="fixed inset-y-0 right-0 w-80 bg-white shadow-lg transform transition-transform duration-200 ease-in-out z-50"
    [class.translate-x-0]="isConfigMode"
    [class.translate-x-full]="!isConfigMode"
  >
    <div class="flex flex-col h-full">
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <div>
          <h2 class="text-lg font-medium text-gray-900">Dashboard Configuration</h2>
          <p class="text-sm text-gray-500">Customize your dashboard widgets</p>
        </div>
        <button
          type="button"
          class="p-1 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md"
          (click)="closeConfigSidebar()"
        >
          <lucide-icon [img]="xIcon" class="h-5 w-5"></lucide-icon>
        </button>
      </div>
      
      <div class="flex-1 overflow-y-auto p-6">
        <div *ngIf="config" class="space-y-4">
          <div class="text-sm text-gray-600 mb-4">
            <p>Toggle widgets on/off to customize your dashboard view. Changes are saved automatically.</p>
          </div>
          <div *ngFor="let widget of config.widgets" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
            <div class="flex-1">
              <h3 class="text-sm font-medium text-gray-900">{{ widget.title }}</h3>
              <p class="text-xs text-gray-500 capitalize">{{ widget.type.replace('-', ' ') }}</p>
            </div>
            <button
              type="button"
              class="p-1 text-gray-400 hover:text-gray-600 transition-colors"
              (click)="toggleWidget(widget)"
              [title]="widget.isVisible ? 'Hide widget' : 'Show widget'"
            >
              <lucide-icon 
                [img]="widget.isVisible ? eyeIcon : eyeOffIcon" 
                class="h-4 w-4"
                [class.text-green-600]="widget.isVisible"
                [class.text-gray-400]="!widget.isVisible"
              ></lucide-icon>
            </button>
          </div>
          
          <!-- Configuration Summary -->
          <div class="mt-6 p-3 bg-blue-50 rounded-lg">
            <h4 class="text-sm font-medium text-blue-900 mb-2">Configuration Summary</h4>
            <div class="text-xs text-blue-800">
              <p>Visible widgets: {{ getVisibleWidgets().length }} of {{ config.widgets.length }}</p>
              <p>Auto-refresh: {{ config.refreshInterval }}s</p>
            </div>
          </div>
        </div>
        
        <div *ngIf="!config" class="flex items-center justify-center h-32">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
          <span class="ml-3 text-gray-600">Loading configuration...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <div class="px-4 py-6 sm:px-0">
      
      <!-- Loading State -->
      <div *ngIf="loading" class="flex items-center justify-center h-64">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
        <span class="ml-3 text-gray-600">Loading dashboard...</span>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="rounded-md bg-red-50 p-4 mb-6">
        <div class="text-sm text-red-700">{{ error }}</div>
        <button 
          type="button" 
          class="mt-2 text-sm font-medium text-red-600 hover:text-red-500"
          (click)="refreshDashboard()"
        >
          Try again
        </button>
      </div>

      <!-- Dashboard Content -->
      <div *ngIf="!loading && !error" class="space-y-6">
        
        <!-- Configuration Mode Banner -->
        <div *ngIf="isConfigMode" class="rounded-md bg-blue-50 p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <lucide-icon [img]="settingsIcon" class="h-5 w-5 text-blue-400"></lucide-icon>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-blue-800">Configuration Mode</h3>
              <p class="text-sm text-blue-700">Use the sidebar to show/hide widgets. Click the settings button again to save changes.</p>
            </div>
          </div>
        </div>

        <!-- Stats Overview -->
        <ng-container *ngFor="let widget of getVisibleWidgets()">
          <app-stats-cards 
            *ngIf="widget.type === 'stats-cards'" 
            [stats]="stats">
          </app-stats-cards>
          
          <div *ngIf="widget.type === 'line-chart' || widget.type === 'pie-chart'" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <app-chart 
              *ngIf="widget.type === 'line-chart'"
              [data]="stats?.salesChartData || []"
              [title]="widget.title"
              [type]="'bar'">
            </app-chart>
            
            <app-chart 
              *ngIf="widget.type === 'pie-chart'"
              [data]="stats?.inventoryChartData || []"
              [title]="widget.title"
              [type]="'pie'">
            </app-chart>
          </div>
          
          <app-activity-feed 
            *ngIf="widget.type === 'activity-feed'"
            [activities]="stats?.recentActivities || []">
          </app-activity-feed>
          
          <!-- Low Stock Alerts -->
          <div *ngIf="widget.type === 'alert-list'" class="bg-white shadow-lg rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-medium text-gray-900">{{ widget.title }}</h3>
            </div>
            <div class="p-6">
              <div *ngIf="(stats?.lowStockItems?.length || 0) === 0" class="text-center py-8">
                <p class="text-gray-500">No low stock alerts</p>
              </div>
              <div *ngIf="(stats?.lowStockItems?.length || 0) > 0" class="space-y-3">
                <div *ngFor="let item of stats?.lowStockItems" 
                     class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                  <div>
                    <p class="font-medium text-gray-900">{{ item.name }}</p>
                    <p class="text-sm text-gray-500">SKU: {{ item.sku }}</p>
                  </div>
                  <div class="text-right">
                    <p class="text-sm font-medium text-red-600">{{ item.currentStock }} left</p>
                    <p class="text-xs text-gray-500">Min: {{ item.minimumStock }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Top Products -->
          <div *ngIf="widget.type === 'product-list'" class="bg-white shadow-lg rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-medium text-gray-900">{{ widget.title }}</h3>
            </div>
            <div class="p-6">
              <div *ngIf="(stats?.topProducts?.length || 0) === 0" class="text-center py-8">
                <p class="text-gray-500">No product data available</p>
              </div>
              <div *ngIf="(stats?.topProducts?.length || 0) > 0" class="space-y-3">
                <div *ngFor="let product of stats?.topProducts" 
                     class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div>
                    <p class="font-medium text-gray-900">{{ product.name }}</p>
                    <p class="text-sm text-gray-500">SKU: {{ product.sku }}</p>
                  </div>
                  <div class="text-right">
                    <p class="text-sm font-medium text-green-600">${{ product.revenue.toLocaleString() }}</p>
                    <p class="text-xs text-gray-500">{{ product.totalSold }} sold</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
        
      </div>
    </div>
  </main>
</div>
